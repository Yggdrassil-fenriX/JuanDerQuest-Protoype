<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JuanDer Quest</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        /* Custom animations for the Start Page */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 1s ease-out forwards;
        }
        .animate-fade-in-up-delay {
            animation: fade-in-up 1s ease-out 0.5s forwards;
            opacity: 0; /* Start hidden */
        }
        @keyframes pop-in {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-pop-in {
            animation: pop-in 0.6s ease-out 1s forwards;
            opacity: 0; /* Start hidden */
        }

        /* CSS for the eco-themed progress bar animation */
        @keyframes fill-progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        .progress-bar-fill {
            animation: fill-progress 2s linear forwards; /* Matches the 2-second timeout */
        }

        /* Hide scrollbar for overflow-x-auto elements */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-50 to-green-100 font-inter text-gray-800 relative flex flex-col">

    <div id="app-root" class="min-h-screen flex flex-col">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <script>
        // Global state variables
        let tokens = 100;
        let xp = 0;
        let level = 1;
        let completedQuests = {};
        let activeView = 'home';
        let isNavOverlayOpen = false;
        let showStartPage = true;

        // XP thresholds for leveling up
        const LEVEL_THRESHOLDS = {
            1: 0, 2: 100, 3: 250, 4: 500, 5: 800, 6: 1200, 7: 1700, 8: 2300, 9: 3000, 10: 4000,
        };

        // Quest data
        const quests = [
            { id: 'tondalinis', category: 'Eco Quests', name: 'Tondalinis Cleanup', description: 'Collect 5 types of trash at Tondaligan Beach and upload a flex-worthy cleanup selfie.', location: 'Tondaligan Beach, Dagupan', rewardTokens: 50, rewardXp: 40, badge: 'Coastal Custodian', rating: 4.5 },
            { id: 'patar-patrol', category: 'Eco Quests', name: 'Patar Patrol: Basura Edition', description: 'Sweep Patar Beach clean and restore dune plants. Channel your inner beach ranger.', location: 'Patar Beach, Bolinao', rewardTokens: 60, rewardXp: 50, badge: 'Beach Ranger', rating: 4.8 },
            { id: 'dasol-dustoff', category: 'Eco Quests', name: 'Dasol Dust-Off', description: 'Bring your eco-bag and clean up Tambobong Beach. Bonus if you sort recyclables.', location: 'Tambobong, Dasol', rewardTokens: 55, rewardXp: 45, badge: 'Basura Buster', rating: 4.2 },
            { id: 'tanim-mo-token-ko', category: 'Green Quests', name: 'Tanim Mo, Token Ko!', description: 'Plant a mangrove seedling and make the environment your side hustle.', location: 'Bani Mangrove Eco Park', rewardTokens: 70, rewardXp: 60, badge: 'Mangrove Monarch NFT', rating: 4.9 },
            { id: 'juan-hundred-islands', category: 'Green Quests', name: 'Juan Hundred Islands', description: 'Visit 3 islands at Hundred Islands, complete eco-trivia per stop, and document it.', location: 'Hundred Islands, Alaminos', rewardTokens: 80, rewardXp: 70, badge: 'Island Explorer', rating: 4.7 },
            { id: 'hike-it-till-you-like-it', category: 'Green Quests', name: 'Hike It Till You Like It', description: 'Trek through Manleluag Spring’s forest trails while collecting trash.', location: 'Mangatarem', rewardTokens: 75, rewardXp: 65, badge: 'Trailblazer', rating: 4.3 },
            { id: 'fin-ish-the-quiz', category: 'Culture & Community Quests', name: 'Fin-ish the Quiz', description: 'Attend Bangus Festival and ace the in-app fishy trivia to win tokens.', location: 'Dagupan (During Bangus Festival)', rewardTokens: 40, rewardXp: 30, badge: 'Bangus Buff', rating: 4.0 },
            { id: 'lakbay-lokal', category: 'Culture & Community Quests', name: 'Lakbay Lokal', description: 'Visit 3 heritage sites in one day — GPS will do the checking, you do the JuanDering.', location: 'Lingayen Capitol, Bolinao Church, War Museum', rewardTokens: 90, rewardXp: 80, badge: 'Time Traveler SBT', rating: 4.6 },
            { id: 'juan-scan-away', category: 'Social & Event-Based Quests', name: 'Juan Scan Away', description: 'Join an LGU-organized clean-up or tree planting. Scan, plant, repeat.', location: 'Rotating barangays across Pangasinan (weekends only)', rewardTokens: 100, rewardXp: 90, badge: 'Bayanihan Boss', rating: 4.9 },
            { id: 'juander-together', category: 'Social & Event-Based Quests', name: 'JuanDer Together', description: 'Complete any quest with a friend. Upload a group photo + dual QR scan.', location: 'Anywhere, as long as you quest together', rewardTokens: 120, rewardXp: 100, badge: 'Friendship Flex', rating: 5.0 },
        ];

        // Function to update level based on XP
        function updateLevel() {
            let newLevel = 1;
            for (const lvl in LEVEL_THRESHOLDS) {
                if (xp >= LEVEL_THRESHOLDS[lvl]) {
                    newLevel = parseInt(lvl);
                } else {
                    break;
                }
            }
            level = newLevel;
        }

        // Function to handle quest completion
        function handleCompleteQuest(questId) {
            const quest = quests.find(q => q.id === questId);
            if (quest && !completedQuests[questId]) {
                tokens += quest.rewardTokens;
                xp += quest.rewardXp;
                completedQuests[questId] = true;
                updateLevel(); // Update level after XP changes
                renderApp(); // Re-render the app to reflect changes
                alert(`Quest "${quest.name}" completed! You earned ${quest.rewardTokens} tokens and ${quest.rewardXp} XP.`);
            } else if (completedQuests[questId]) {
                alert('You have already completed this quest!');
            }
        }

        // Function to simulate adding tokens
        function addTokens(amount, source) {
            tokens += amount;
            renderApp();
            alert(`You gained ${amount} tokens via ${source}!`);
        }

        // Function to simulate token redemption
        function redeemTokens(amount) {
            if (tokens >= amount) {
                tokens -= amount;
                renderApp();
                alert(`You redeemed ${amount} tokens for a discount!`);
            } else {
                alert('Not enough tokens to redeem.');
            }
        }

        // Function to simulate token donation
        function donateTokens(amount) {
            if (tokens >= amount) {
                tokens -= amount;
                renderApp();
                alert(`You donated ${amount} tokens to a heritage site! Thank you for your contribution.`);
            } else {
                alert('Not enough tokens to donate.');
            }
        }

        // --- View Rendering Functions ---

        // Renders the Mobile Navigation Overlay
        function renderNavOverlay() {
            const buttonData = [
                { view: 'home', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l7 7m-2 2v-6a1 1 0 00-1-1H9a1 1 0 00-1 1v6m2-2h6', text: 'Home' },
                { view: 'quests', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01', text: 'Quests' },
                { view: 'profile', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z', text: 'Profile' },
                { view: 'token-utility', icon: 'M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z', text: 'Tokens' },
            ];

            return `
                <div id="nav-overlay" class="fixed inset-0 z-50 flex items-center justify-center transition-opacity duration-300
                    ${isNavOverlayOpen ? 'opacity-100 pointer-events-auto bg-black bg-opacity-50' : 'opacity-0 pointer-events-none bg-transparent'}">
                    <div class="nav-overlay-content grid grid-cols-2 gap-x-4 gap-y-4 p-4">
                        ${buttonData.map((button, index) => `
                            <button
                                data-view="${button.view}"
                                class="flex flex-col items-center justify-center w-20 h-20 rounded-full text-white font-bold text-sm
                                transition-all duration-300 transform shadow-lg
                                ${activeView === button.view ? 'bg-green-800 scale-110' : 'bg-green-700 hover:bg-green-600'}"
                                style="opacity: ${isNavOverlayOpen ? 1 : 0}; transform: ${isNavOverlayOpen ? 'scale(1)' : 'scale(0)'}; transition: all 0.3s ease-out ${isNavOverlayOpen ? index * 0.05 : (buttonData.length - 1 - index) * 0.05}s;"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="${button.icon}" />
                                </svg>
                                ${button.text}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Renders the Home View (now contains the interactive quest content)
        function renderHomeView() {
            return `
                <div class="p-0 bg-white rounded-xl shadow-lg mt-6 max-w-4xl mx-auto overflow-hidden">
                    <div class="relative w-full h-48 bg-gradient-to-b from-green-400 to-green-600 rounded-b-3xl overflow-hidden flex flex-col justify-end pb-4 px-4 shadow-md">
                        <img
                            src="./assets/background.jpg"
                            alt="Mountains background"
                            class="absolute inset-0 w-full h-full object-cover opacity-80"
                            onerror="this.onerror=null;this.src='https://via.placeholder.com/800x300/A7F3D0/10B981?text=Mountains+Fallback';"
                        />
                        <div class="relative z-10 flex justify-between items-start mb-4">
                            <div class="flex items-center">
                                <img
                                    src="./assets/profile-icon.png"
                                    alt="User Profile"
                                    class="w-12 h-12 rounded-full border-2 border-white shadow-md mr-3"
                                    onerror="this.onerror=null;this.src='https://via.placeholder.com/50x50/D1D5DB/FFFFFF?text=User';"
                                />
                                <div>
                                    <p class="text-white text-sm font-semibold">Welcome,</p>
                                    <p class="text-white text-xl font-bold">JuanDerer Lengleng</p>
                                    <div class="flex items-center space-x-3 mt-1">
                                        <span class="text-white text-sm font-semibold flex items-center">
                                            ✨ <span class="font-bold ml-1">${level}</span> Level
                                        </span>
                                        <span class="text-white text-sm font-semibold flex items-center">
                                            💰 <span class="font-bold ml-1">${tokens}</span> Tokens
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <button class="p-2 rounded-full bg-white bg-opacity-30 text-white hover:bg-opacity-50 transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                                </svg>
                            </button>
                        </div>

                        <p class="relative z-10 text-white text-lg font-semibold mb-2">Where do you want to go?</p>
                        <div class="relative z-10 flex items-center bg-white rounded-full px-4 py-2 shadow-md">
                            <input
                                type="text"
                                placeholder="Explore now"
                                class="flex-grow bg-transparent outline-none text-gray-700 placeholder-gray-400"
                            />
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Category Icons -->
                    <div class="flex justify-around p-4 bg-white shadow-sm -mt-4 relative z-10 rounded-t-xl">
                        <div class="flex flex-col items-center text-green-700 font-semibold text-sm">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-1 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m-1 4h1m8-10h1m-1 4h1m-1 4h1m-10 4h.01M17 17h.01" />
                                </svg>
                            </div>
                            All
                        </div>
                        <div class="flex flex-col items-center text-gray-600 font-semibold text-sm">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-1 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l7 7m-2 2v-6a1 1 0 00-1-1H9a1 1 0 00-1 1v6m2-2h6" />
                                </svg>
                            </div>
                            Camping
                        </div>
                        <div class="flex flex-col items-center text-gray-600 font-semibold text-sm">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-1 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z" />
                                </svg>
                            </div>
                            Heritage
                        </div>
                        <div class="flex flex-col items-center text-gray-600 font-semibold text-sm">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-1 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                            Shopping
                        </div>
                        <div class="flex flex-col items-center text-gray-600 font-semibold text-sm">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-1 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                            Adventure
                        </div>
                    </div>

                    <!-- Recommended Section -->
                    <div class="p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800">Recommended</h3>
                            <button class="text-green-600 font-semibold text-sm hover:underline">See All</button>
                        </div>
                        <div class="flex overflow-x-auto space-x-4 pb-4 scrollbar-hide">
                            ${quests.map(quest => `
                                <div class="flex-shrink-0 w-48 bg-gray-50 rounded-lg shadow-md overflow-hidden border border-gray-200">
                                    <div class="w-full h-28 bg-green-200 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-600 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 005-5V7a4 4 0 00-4-4H8a4 4 0 00-4 4v2m0 0l-1 1h10l-1-1m-1 1a2 2 0 100 4m-4-4a2 2 0 100 4m-4-4a2 2 0 100 4m-4-4a2 2 0 100 4m-4-4a2 2 0 100 4m-4-4a2 2 0 100 4" />
                                        </svg>
                                    </div>
                                    <div class="p-3">
                                        <div class="flex items-center text-yellow-500 text-xs mb-1">
                                            ${Array.from({ length: 5 }).map((_, i) => `
                                                <svg key="${i}" class="h-4 w-4 ${i < Math.floor(quest.rating) ? 'text-yellow-500' : 'text-gray-300'}" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.538 1.118l-2.8-2.034a1 1 0 00-1.176 0l-2.8 2.034c-.783.57-1.838-.197-1.538-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z" />
                                                </svg>
                                            `).join('')}
                                            <span class="ml-1 text-gray-600">(${quest.rating})</span>
                                        </div>
                                        <p class="font-semibold text-gray-800 text-sm mb-1">${quest.name}</p>
                                        <p class="text-gray-500 text-xs truncate">${quest.location}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <br>
                        <div class="bg-[#e8c49f] rounded-xl p-3">
                            <p class="text-center">Take a quiz to earn extra tokens and discover fun facts about your destination.</p>
                            <br>
                            <div>
                                <button
                                    class="
                                    transform transition-all background-transparent
                                    flex items-center justify-center relative"
                                >
                                        <img src="./assets/quizbutton.png" class="w-5/12 m-0 h-1/2">
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
                </div>
            `;
        }

        // Renders the Quests View (now contains the welcome content)
        function renderQuestsView() {
            return `
                <div class="p-6 bg-white rounded-xl shadow-lg mt-6 max-w-4xl mx-auto relative overflow-hidden">
                    <img
                        src="https://imgbin.com/png/pB38tXBZ/paper-scroll-png"
                        alt="Scroll background"
                        class="absolute inset-0 w-full h-full object-cover opacity-10 z-0 rounded-xl"
                    />
                    <div class="relative z-10">
                        <h2 class="text-3xl font-bold text-green-700 mb-4 text-center">Welcome, JuanDerer!</h2>
                        <p class="text-gray-700 text-lg mb-4 text-center">
                            Embark on your eco-adventure with JuanDer Quest. Complete quests, earn tokens, and make a real impact!
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                            <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                                <h3 class="text-xl font-semibold text-emerald-800 mb-3">Your Impact So Far</h3>
                                <p class="text-gray-700">Tokens Earned: <span class="font-bold text-green-600">${tokens}</span></p>
                                <p class="text-gray-700">XP Gained: <span class="font-bold text-green-600">${xp}</span></p>
                                <p class="text-gray-700">Current Level: <span class="font-bold text-green-600">${level}</span></p>
                            </div>
                            <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                                <h3 class="text-xl font-semibold text-emerald-800 mb-3">About JuanDer Quest</h3>
                                <p class="text-gray-700 text-sm">
                                    JuanDer Quest is a gamified, blockchain-based eco-tourism app rewarding eco-friendly behavior with tokens.
                                    These tokens can be redeemed for local shop discounts, donated to heritage sites, or used to level up.
                                    We combine environmental sustainability, local economic empowerment, and Web3 technology for engaging, impactful, and rewarding experiences.
                                </p>
                            </div>
                        </div>
                        <div class="mt-8 text-center">
                            <button
                                id="go-to-home-button"
                                class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition-transform duration-300 hover:scale-105"
                            >
                                Go to Home!
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Renders the Profile View
        function renderProfileView() {
            const nextLevelXpThreshold = LEVEL_THRESHOLDS[level + 1] || xp;
            const progressToNextLevel = level < 10 ? Math.max(0, xp - LEVEL_THRESHOLDS[level]) : 0;
            const totalXpForCurrentLevel = LEVEL_THRESHOLDS[level];
            const totalXpNeededForNextLevel = level < 10 ? (nextLevelXpThreshold - totalXpForCurrentLevel) : 0;
            const progressPercentage = totalXpNeededForNextLevel > 0 ? (progressToNextLevel / totalXpNeededForNextLevel) * 100 : 100;

            const earnedBadges = Array.from(new Set(
                Object.keys(completedQuests)
                    .filter(id => completedQuests[id])
                    .map(id => quests.find(q => q.id === id)?.badge)
                    .filter(Boolean)
            ));

            return `
                <div class="p-6 bg-white rounded-xl shadow-lg mt-6 max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">Your JuanDerer Profile</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Level & Progress</h3>
                            <p class="text-gray-700 text-lg mb-2">Current Level: <span class="font-bold text-green-600">${level}</span></p>
                            <p class="text-gray-700 text-lg mb-4">Total XP: <span class="font-bold text-green-600">${xp}</span></p>

                            ${level < 10 ? `
                                <p class="text-gray-600 text-sm mb-2">
                                    XP to next level (${level + 1}): <span class="font-bold">${nextLevelXpThreshold - xp}</span>
                                </p>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div
                                        class="bg-green-500 h-3 rounded-full transition-all duration-500 ease-out"
                                        style="width: ${progressPercentage}%"
                                    ></div>
                                </div>
                                <p class="text-right text-xs text-gray-500 mt-1">${Math.round(progressPercentage)}%</p>
                            ` : `
                                <p class="text-green-600 font-bold text-lg">You've reached the maximum level!</p>
                            `}
                        </div>

                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Earned Badges</h3>
                            ${earnedBadges.length > 0 ? `
                                <ul class="list-disc list-inside text-gray-700">
                                    ${earnedBadges.map(badge => `
                                        <li class="mb-1">🌟 ${badge}</li>
                                    `).join('')}
                                </ul>
                            ` : `
                                <p class="text-gray-600">Complete quests to earn badges!</p>
                            `}
                        </div>
                    </div>

                    <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                        <h3 class="text-xl font-semibold text-emerald-800 mb-3">Completed Quests</h3>
                        ${Object.keys(completedQuests).length > 0 ? `
                            <ul class="list-disc list-inside text-gray-700">
                                ${Object.keys(completedQuests).map(questId => {
                                    const quest = quests.find(q => q.id === questId);
                                    return quest ? `<li class="mb-1">✅ ${quest.name}</li>` : '';
                                }).join('')}
                            </ul>
                        ` : `
                            <p class="text-gray-600">No quests completed yet. Go out and JuanDer!</p>
                        `}
                    </div>
                </div>
            `;
        }

        // Renders the Token Utility View
        function renderTokenUtilityView() {
            return `
                <div class="p-6 bg-white rounded-xl shadow-lg mt-6 max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">Token Utility</h2>
                    <p class="text-gray-700 text-lg mb-6 text-center">Your current balance: <span class="font-bold text-green-600">${tokens}</span> Tokens</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Redeem for Discounts</h3>
                            <p class="text-gray-700 text-sm mb-4">Use your tokens to get discounts and vouchers at partner local shops.</p>
                            <button
                                id="redeem-50-tokens"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-transform duration-300 hover:scale-105"
                            >
                                Redeem 50 Tokens
                            </button>
                        </div>

                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Donate to Heritage Sites</h3>
                            <p class="text-gray-700 text-sm mb-4">Support local heritage sites and protected areas with your tokens.</p>
                            <button
                                id="donate-20-tokens"
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-transform duration-300 hover:scale-105"
                            >
                                Donate 20 Tokens
                            </button>
                        </div>

                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Top-up Tokens</h3>
                            <p class="text-gray-700 text-sm mb-4">Need more tokens for quests or rewards? Purchase them easily!</p>
                            <button
                                id="top-up-100-tokens"
                                class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-transform duration-300 hover:scale-105"
                            >
                                Buy 100 Tokens
                            </button>
                        </div>

                        <div class="bg-emerald-50 p-5 rounded-lg shadow-md border border-emerald-200">
                            <h3 class="text-xl font-semibold text-emerald-800 mb-3">Watch Ads for Bonus</h3>
                            <p class="text-gray-700 text-sm mb-4">Watch eco-aligned ads to double your tokens!</p>
                            <button
                                id="watch-ad-double-tokens"
                                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-transform duration-300 hover:scale-105"
                            >
                                Watch Ad (Double Tokens)
                            </button>
                        </div>
                    </div>
            `;
        }

        // Renders the Start Page
        function renderStartPage() {
            return `
                <div id="start-page" class="fixed inset-0 bg-gradient-to-br from-green-500 to-emerald-700 flex flex-col items-center justify-center z-[100] text-white p-4 text-center" style="background-image: url('./assets/start-page.png');">
                    <img
                        src="./assets/logo.png"
                        alt="JuanDer Quest Logo"
                        class="w-full max-w-xl mb-8 animate-fade-in-up rounded-lg shadow-lg"
                        onerror="this.onerror=null;this.src='https://via.placeholder.com/600x100.png?text=JuanDer+Quest+Logo+Fallback';"
                    />
                    ${isAnimatingLoading ? `
                        <div class="flex flex-col items-center">
                            <p class="text-xl font-semibold mb-4">Preparing your adventure...</p>
                            <div class="progress-bar-container w-64 h-6 bg-gray-200 rounded-full overflow-hidden shadow-inner">
                                <div class="progress-bar-fill h-full rounded-full bg-gradient-to-r from-lime-400 to-green-600"></div>
                            </div>
                        </div>
                    ` : `
                        <button
                            id="start-adventure-button"
                            class="
                            transform transition-all background-transparent duration-300 animate-pop-in
                            flex items-center justify-center space-x-3 relative"
                        >
                            <img src="./assets/startbutton.png" class="w-8/12">
                        </button>
                    `}
                </div>
            `;
        }

        // --- Main Application Rendering ---

        let isAnimatingLoading = false; // Local state for StartPage animation

        function renderApp() {
            const appRoot = document.getElementById('app-root');
            if (!appRoot) return;

            let htmlContent = '';

            if (showStartPage) {
                htmlContent = renderStartPage();
                appRoot.innerHTML = htmlContent;
                // Add event listener for start button after rendering
                const startButton = document.getElementById('start-adventure-button');
                if (startButton) {
                    startButton.onclick = () => {
                        isAnimatingLoading = true;
                        renderApp(); // Re-render to show loading bar
                        setTimeout(() => {
                            showStartPage = false;
                            isAnimatingLoading = false; // Reset loading state
                            renderApp(); // Render main app
                        }, 2000);
                    };
                }
            } else {
                let mainContentHtml = '';
                // Adjusted padding for main content, now that fixed top elements are removed
                // pt-4 for mobile, pt-6 for desktop (just general spacing)
                const mainPaddingClass = 'pt-4 md:pt-6';

                switch (activeView) {
                    case 'home':
                        mainContentHtml = renderHomeView();
                        break;
                    case 'quests':
                        mainContentHtml = renderQuestsView();
                        break;
                    case 'profile':
                        mainContentHtml = renderProfileView();
                        break;
                    case 'token-utility':
                        mainContentHtml = renderTokenUtilityView();
                        break;
                    default:
                        mainContentHtml = renderHomeView();
                }

                htmlContent = `
                    <main class="container mx-auto px-4 flex-grow pb-20 md:pb-8 ${mainPaddingClass}">
                        ${mainContentHtml}
                    </main>
                    <button id="mobile-nav-toggle" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-green-600 hover:bg-green-700 text-white text-lg font-bold py-3 px-6 rounded-full shadow-xl transform transition-transform duration-300 hover:scale-105 z-[99] flex items-center justify-center w-16 h-16 relative">
                        <img src="./assets/NavButton.png" class="absolute">
                    </button>
                    ${renderNavOverlay()}
                `;
                appRoot.innerHTML = htmlContent;

                // Attach event listeners after rendering
                attachEventListeners();
            }
        }

        function attachEventListeners() {
            // Mobile Nav Toggle Button (now primary navigation)
            const mobileNavToggleButton = document.getElementById('mobile-nav-toggle');
            if (mobileNavToggleButton) {
                mobileNavToggleButton.onclick = () => {
                    isNavOverlayOpen = !isNavOverlayOpen;
                    renderApp();
                };
            }

            // Mobile Nav Overlay buttons
            const navOverlay = document.getElementById('nav-overlay');
            if (navOverlay) {
                navOverlay.onclick = (event) => {
                    // Only close if clicking on the backdrop, not on the buttons themselves
                    if (event.target.id === 'nav-overlay') {
                        isNavOverlayOpen = false;
                        renderApp();
                    }
                };
                navOverlay.querySelectorAll('.nav-overlay-content button').forEach(button => {
                    button.onclick = (event) => {
                        activeView = event.currentTarget.dataset.view; // Use currentTarget to get the button
                        isNavOverlayOpen = false;
                        renderApp();
                    };
                });
            }

            // Quest completion (example, actual implementation would be more complex)
            const goToHomeButton = document.getElementById('go-to-home-button');
            if (goToHomeButton) {
                goToHomeButton.onclick = () => {
                    activeView = 'home';
                    renderApp();
                };
            }

            // Token Utility buttons
            const redeemButton = document.getElementById('redeem-50-tokens');
            if (redeemButton) redeemButton.onclick = () => redeemTokens(50);

            const donateButton = document.getElementById('donate-20-tokens');
            if (donateButton) donateButton.onclick = () => donateTokens(20);

            const topUpButton = document.getElementById('top-up-100-tokens');
            if (topUpButton) topUpButton.onclick = () => addTokens(100, 'Top-up');

            const watchAdButton = document.getElementById('watch-ad-double-tokens');
            if (watchAdButton) watchAdButton.onclick = () => addTokens(tokens, 'Watching Ad');

            const alimangoQuizButton = document.getElementById('alimango-quiz-button');
            if (alimangoQuizButton) alimangoQuizButton.onclick = () => addTokens(30, 'Alimango Quiz');

            const hundredIslandsTriviaButton = document.getElementById('hundred-islands-trivia-button');
            if (hundredIslandsTriviaButton) hundredIslandsTriviaButton.onclick = () => addTokens(tokens * 0.5, 'Hundred Islands Trivia');
        }

        // Initial render when the window loads
        window.onload = renderApp;

    </script>
</body>
</html>
